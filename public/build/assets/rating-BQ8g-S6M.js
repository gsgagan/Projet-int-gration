import{r as n,j as e,c as N}from"./client-3DVn_WlK.js";const w=({showId:a})=>{const[i,l]=n.useState(0),[d,m]=n.useState(0),[E,f]=n.useState(0),[h,p]=n.useState(0),[u,j]=n.useState(0),[R,x]=n.useState(!1),[c,o]=n.useState(""),[g,y]=n.useState(!1);n.useEffect(()=>{const r=document.getElementById("star-rating-component");r&&y(r.dataset.userLoggedIn==="true")},[]),n.useEffect(()=>{a&&(async()=>{try{const s=await fetch(`/api/shows/${a}/ratings`);if(!s.ok)throw new Error("Erreur lors de la récupération des notes");const t=await s.json();f(t.averageRating),p(t.totalRatings),t.userRating&&(j(t.userRating),l(t.userRating))}catch(s){console.error("Erreur:",s)}})()},[a]);const S=async r=>{if(!g){o("Vous devez être connecté pour noter ce spectacle");return}if(!R){x(!0),o("");try{const s=await fetch(`/api/shows/${a}/rate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({score:r})}),t=await s.json();s.ok?(l(r),j(r),f(t.averageRating),p(v=>u?v:v+1),o("Votre note a été enregistrée !")):o(t.error||"Une erreur est survenue")}catch{o("Erreur de connexion. Veuillez réessayer.")}finally{x(!1)}}};return e.jsxs("div",{className:"star-rating-container",children:[e.jsx("h3",{children:"Notez ce spectacle"}),e.jsx("div",{className:"stars",children:[...Array(5)].map((r,s)=>{const t=s+1;return e.jsx("span",{className:`star ${t<=(d||i)?"active":""}`,onClick:()=>S(t),onMouseEnter:()=>g&&m(t),onMouseLeave:()=>g&&m(0),children:e.jsx("i",{className:`fa${t<=(d||i)?"s":"r"} fa-star`})},s)})}),e.jsxs("div",{className:"rating-stats",children:[e.jsxs("p",{children:["Note moyenne : ",e.jsx("strong",{children:E}),"/5 (",h," vote",h!==1?"s":"",")"]}),u>0&&e.jsxs("p",{children:["Votre note : ",e.jsxs("strong",{children:[u,"/5"]})]})]}),c&&e.jsx("div",{className:`rating-message ${c.includes("erreur")||c.includes("connecté")?"error":"success"}`,children:c}),R&&e.jsxs("div",{className:"rating-loading",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Envoi en cours..."]}),!g&&e.jsxs("p",{className:"login-message",children:[e.jsx("a",{href:"/login",children:"Connectez-vous"})," pour noter ce spectacle"]})]})};document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("star-rating-component");if(a){const i=a.dataset.showId;N.createRoot(a).render(e.jsx(w,{showId:i}))}});
